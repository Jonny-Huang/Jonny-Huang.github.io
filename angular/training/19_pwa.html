<hr>
<p>title: PWA 偽裝術：manifest.json<br>date: 2017-09-25 08:00<br>categories: Training<br>keywords:</p>
<ul>
<li>Angular</li>
<li>manifest.json</li>
<li>Progressive Web App</li>
<li>PWA<br>tags:</li>
<li>PWA</li>
</ul>
<hr>
<h1 id="漸進式網頁應用程式-Progressive-Web-App"><a href="#漸進式網頁應用程式-Progressive-Web-App" class="headerlink" title="漸進式網頁應用程式 (Progressive Web App)"></a>漸進式網頁應用程式 (Progressive Web App)</h1><p>什麼是 <strong>漸進式網頁應用程式</strong>(<strong>PWA</strong>) 其在網路上已經有很多篇文章了，筆者看完得到的結論就是-<strong>讓以前只有 APP 做得到的事情，現在在 Web 上也可以做到</strong>，而現在之所以能實現是因為<strong>新版</strong>的瀏覽器增加了相關功能，言下之意就是<strong>瀏覽器的版本</strong>很重要，後續測試會以 Google Chrome 為主。  </p>
<!-- more -->  
<p>我們可以看一下 W3C 最新的 <a href="https://www.w3.org/TR/appmanifest/">Web App Manifest</a> 草案，可以看到編輯者主要來自 Mozilla、Intel、Google、Microsotf，這意味著主流瀏覽器都將支援。<br><img src="/images/angular/training/pwa/pwa_01.png" alt="img"><br>雖然 Apple 並沒有在名單內，不過 查看 <a href="https://webkit.org/status/#specification-web-app-manifest">WebKit Feature Status</a> 可以看到 <strong>Web App Manifest</strong> 已經列入考慮選項內，這也表示如果沒有意外 Safari 未來也將支援。<br><img src="/images/angular/training/pwa/pwa_02.png" alt="img">  </p>
<blockquote>
<p>參考文件：<a href="https://developers.google.com/web/fundamentals/getting-started/codelabs/your-first-pwapp/?hl=zh-tw">你的首個 Progressive Web App</a></p>
</blockquote>
<h2 id="manifest-json"><a href="#manifest-json" class="headerlink" title="manifest.json"></a>manifest.json</h2><p><strong>manifest.json</strong> 與 <strong>Service Work</strong> 可以說是 PWA 最核心的功能，比起較複雜的 <strong>Service Work</strong>，本篇先練習如何透過 <strong>manifest.json</strong> 就可以讓 Web APP 看起來跟一般的 APP 一樣。</p>
<p>這邊我們拿之前練習到 <a href="/angular/training/17_angular_service/">Angular 服務</a> 的程式來當範例。<br>{% img /images/download.png 36 %}<a href="/uploads/first-app_2017-09-14.zip"><strong>first-app_2017-09-14.zip</strong></a>  </p>
<blockquote>
<p>若要下載請記得先透過指令 <code>npm install</code> 來重新安裝 package。</p>
</blockquote>
<p>我們在專案目錄下的 <code>src</code> 資料夾內建立一個 <code>manifest.json</code>，並添加相關設定值，以及應用程式圖示，下面是比較常用的設定值：  </p>
<blockquote>
<p>若是 Angular 專案，別忘了將 <code>manifest.json</code> 加到 <code>.angular-cli.json</code> 的 <code>assets</code>，這樣建置時才會將 <code>manifest.json</code> 一併複製。<br><img src="/images/angular/training/pwa/pwa_22.png" alt="img"></p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">欄位</th>
<th>說明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">name</td>
<td>應用程式名稱</td>
</tr>
<tr>
<td align="center">short_name</td>
<td>應用程式簡稱</td>
</tr>
<tr>
<td align="center">display</td>
<td>顯示模式：<code>fullscreen</code>、<code>standalone</code>、<code>minimal-ui</code>、<code>browser</code></td>
</tr>
<tr>
<td align="center">start_url</td>
<td>設定起始頁面</td>
</tr>
<tr>
<td align="center">description</td>
<td>應用程式描述</td>
</tr>
<tr>
<td align="center">scope</td>
<td>相關設定影響範圍</td>
</tr>
<tr>
<td align="center">background_color</td>
<td>啟動畫面(Splashscreen)背景顏色</td>
</tr>
<tr>
<td align="center">theme_color</td>
<td>主題顏色</td>
</tr>
<tr>
<td align="center">dir</td>
<td>排版方式：<code>ltr</code>(由左到右)、<code>rtl</code>(由右到左)、<code>auto</code></td>
</tr>
<tr>
<td align="center">lang</td>
<td>應用程式語系</td>
</tr>
<tr>
<td align="center">orientation</td>
<td>螢幕方向：<code>any</code>、<code>natural</code>、<code>landscape</code>、<code>portrait</code>、<code>portrait-primary</code>、<code>portrait-secondary</code>、<code>landscape-primary</code>、<code>landscape-secondary</code></td>
</tr>
<tr>
<td align="center">icons</td>
<td>應用程式圖示</td>
</tr>
</tbody></table>
<blockquote>
<p>其他設定可參考<br>W3C - <a href="https://www.w3.org/TR/appmanifest/">Web App Manifest</a><br>MDN - <a href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions/manifest.json">WebExtensions：manifest.json</a> </p>
</blockquote>
<p>我們先添加應用程式名稱與圖示：<br><img src="/images/angular/training/pwa/pwa_03.png" alt="img">  </p>
<p>{% codeblock manifest.json lang:json %}<br>{<br>  “name”: “WebApp - First App”,<br>  “short_name”: “FirstApp”,<br>  “description”: “My First APP”,<br>  “icons”: [<br>    {<br>      “src”: “./assets/images/android_048.png”,<br>      “sizes”: “48x48”,<br>      “type”: “image/png”<br>    },<br>    {<br>      “src”: “./assets/images/android_096.png”,<br>      “sizes”: “96x96”,<br>      “type”: “image/png”<br>    },<br>    {<br>      “src”: “./assets/images/android_144.png”,<br>      “sizes”: “144x144”,<br>      “type”: “image/png”<br>    },<br>    {<br>      “src”: “./assets/images/android_192.png”,<br>      “sizes”: “192x192”,<br>      “type”: “image/png”<br>    },<br>    {<br>      “src”: “./assets/images/android_512.png”,<br>      “sizes”: “512x512”,<br>      “type”: “image/png”<br>    }<br>  ]<br>}</p>
<p>{% endcodeblock %}</p>
<blockquote>
<p><img src="/images/angular/training/pwa/metro_studio.png" alt="img"><br>找不到圖示的，可以像筆者一樣去下載 <a href="https://www.syncfusion.com/downloads/metrostudio">Metro Studio</a>，註冊帳號後就會收到一組免費序號，目前版本累積圖示有 7000 多個，可以自己調整圖示大小、顏色、旋轉、外框，也提供多種匯出格式，不過最重要的是可以用於<strong>商業用途</strong>。<br><img src="/images/angular/training/pwa/pwa_04.png" alt="img"></p>
</blockquote>
<h2 id="link"><a href="#link" class="headerlink" title="link"></a>link</h2><p>接著就是將 <code>manifest.json</code> 關連到網頁上，開啟 <code>src\index.html</code>，將下列語法加入 <code>head</code> tag 內。<br><code>&lt;link rel=&quot;manifest&quot; href=&quot;manifest.json&quot;&gt;</code>  </p>
<p>{% codeblock index.html lang:html %}<br><!doctype html></p>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>FirstApp</title>
  <base href="./">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="manifest" href="manifest.json">
</head>

<body oncontextmenu="return false">
  <app-root></app-root>
</body>

</html>

<p>{% endcodeblock %}</p>
<h3 id="Safari"><a href="#Safari" class="headerlink" title="Safari"></a>Safari</h3><p>目前針對 Safari 瀏覽器我們需要在網頁內的 <code>head</code> tag 加入額外設定，尤其需要針對不同 iOS 裝置提供對應尺寸的圖示，當 Safari 正是支援 W3C 標準後應該就可以省略，修改設定如下：<br><code>&lt;meta name=&quot;apple-mobile-web-app-capable&quot; content=&quot;yes&quot;&gt;</code>  </p>
<p>{% codeblock index.html lang:html %}<br>…</p>
<head>
  ...
  <link rel="manifest" href="manifest.json">
  <!-- Apple Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="WebApp - First App">
  <link rel="apple-touch-icon" href="./assets/images/android_057.png" sizes="57x57">
  <link rel="apple-touch-icon" href="./assets/images/android_060.png" sizes="60x60">
  <link rel="apple-touch-icon" href="./assets/images/android_072.png" sizes="72x72">
  <link rel="apple-touch-icon" href="./assets/images/android_076.png" sizes="76x76">
  <link rel="apple-touch-icon" href="./assets/images/android_114.png" sizes="114x114">
  <link rel="apple-touch-icon" href="./assets/images/android_120.png" sizes="120x120">
  <link rel="apple-touch-icon" href="./assets/images/android_144.png" sizes="144x144">
  <link rel="apple-touch-icon" href="./assets/images/android_152.png" sizes="152x152">
  <link rel="apple-touch-icon" href="./assets/images/android_167.png" sizes="167x167">
  <link rel="apple-touch-icon" href="./assets/images/android_180.png" sizes="180x180">
</head>
...
{% endcodeblock %}
  
<blockquote>
<p>參考文件：<a href="https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html">Configuring Web Applications</a></p>
</blockquote>
<h2 id="Windows：加到桌面"><a href="#Windows：加到桌面" class="headerlink" title="Windows：加到桌面"></a>Windows：加到桌面</h2><p>執行指令 <code>ng serve</code> 來啟動 Angular 專案，點選 Chrome 瀏覽器 <strong>加到桌面</strong> 功能，從出現的對話視窗可以看到，圖示跟應用程式名稱都是來自 <code>manifest.json</code>，確認後可以發現桌面多一個<strong>類似應用程式的捷徑</strong>。<br><img src="/images/angular/training/pwa/pwa_05.png" alt="img"><br><img src="/images/angular/training/pwa/pwa_06.png" alt="img"><br>點選捷徑啟動<strong>應用程式</strong>，可以發現透過 Chrome 預設開啟時就我們隱藏網址列與工具列，若不是透過滑鼠右鍵的功能選單，還真的很難發現這是 Web App，跟我們在 <a href="/angular/training/18_electron/">Electron：跨平台的視窗應用程式</a> 所做的步驟比起來是否更加簡單。<br><img src="/images/angular/training/pwa/pwa_07.png" alt="img">  </p>
<blockquote>
<p>如果確定網站不會使用到滑鼠右鍵，那可以更進一步把右鍵隱藏，讓一般使用者幾乎無法察覺。<br><img src="/images/angular/training/pwa/pwa_08.png" alt="img"></p>
</blockquote>
<h3 id="start-url"><a href="#start-url" class="headerlink" title="start_url"></a>start_url</h3><p>接下來我們安裝 Chrome 擴充功能-<a href="https://chrome.google.com/webstore/detail/web-server-for-chrome/ofhbbkphhbklhfoeikjpcbhemlocgigb">Web Server for Chrome</a>，透過它可以快速建立一個網頁伺服器，我們只要將資料夾設定為 Angular 輸出資料夾 <code>dist</code>，接著啟動 Web Server 就可以開始使用，在這邊筆者特別將連接埠改為 8081，透過瀏覽器檢視 <a href="http://10.0.1.107:8081。">http://10.0.1.107:8081。</a><br><img src="/images/angular/training/pwa/pwa_08.png" alt="img"><br><img src="/images/angular/training/pwa/pwa_09.png" alt="img"><br>再將 Web 程式加到桌面，我們可以注意到因為 Angular 路由規則的關係預設會被導到<strong>待辦事項</strong>，所以網址會變成 <a href="http://10.0.1.107:8081/home/to-do-list%E3%80%82">http://10.0.1.107:8081/home/to-do-list。</a><br><img src="/images/angular/training/pwa/pwa_10.png" alt="img"><br>接著透過桌面捷徑啟動，可以發現找不到 <strong>/home/to-do-list</strong> 的錯誤訊息，這是因為 Angular 是一個 SPA 網頁應用程式，所以除了首頁(index.html)之外就沒有任何實體網頁，網址列上的網址都是 Angular 路由模組產生的路由路徑，實際上並不存在。<br><img src="/images/angular/training/pwa/pwa_11.png" alt="img"><br><img src="/images/angular/training/pwa/pwa_12.png" alt="img"><br>我們可以透過設定 <strong>manifest.json</strong> 的 <code>start_url</code> 來解決這個問題，將 <code>start_url</code> 設定為首頁-<code>index.html</code>，透過添加此屬性，可以強制改由 <code>start_url</code> 所指定的網址來開啟。  </p>
<p>{% codeblock manifest.json lang:json %}<br>{<br>  “name”: “WebApp - First App”,<br>  “short_name”: “FirstApp”,<br>  “start_url”: “./index.html”,<br>  “description”: “My First APP”,<br>  “icons”: […]<br>}</p>
<p>{% endcodeblock %}</p>
<p>重新建立潔淨後再執行應該就能正常顯示了。<br><img src="/images/angular/training/pwa/pwa_13.png" alt="img">  </p>
<h2 id="Android：加到主畫面"><a href="#Android：加到主畫面" class="headerlink" title="Android：加到主畫面"></a>Android：加到主畫面</h2><p>接著我們改用 Android 手機的 Chrome 瀏覽器連結網站 <a href="http://10.0.1.107:8081。">http://10.0.1.107:8081。</a><br><img src="/images/angular/training/pwa/pwa_14.png" alt="img"><br>透過 Chrome <strong>加到主畫面</strong> 功能，我們一樣可以將網站釘選到手機桌面，只是預設名稱會改用 <strong>應用程式簡稱</strong>(<strong>short_name</strong>)，點選新增後就會在手機桌面建立捷徑。<br><img src="/images/angular/training/pwa/pwa_15.png" alt="img"><br><img src="/images/angular/training/pwa/pwa_16.png" alt="img"><br><img src="/images/angular/training/pwa/pwa_17.png" alt="img"><br>點選捷徑來啟動 Web App 可以發現在網頁載入的等待過程會有 <strong>啟動畫面</strong>(<strong>Splashscreen</strong>)，開啟後可以發現一樣是沒有網址列的滿版網頁。<br><img src="/images/angular/training/pwa/pwa_18.png" alt="img"><br><img src="/images/angular/training/pwa/pwa_19.png" alt="img">  </p>
<p>最後我們在 <code>manifest.json</code> 內在透過 <code>background_color</code> 來設定<strong>啟動畫面</strong>的背景顏色，透過 <code>theme_color</code> 來設定手機的主題顏色，修改如下：  </p>
<p>{% codeblock manifest.json lang:json %}<br>{<br>  “name”: “WebApp - First App”,<br>  “short_name”: “FirstApp”,<br>  “start_url”: “./index.html”,<br>  “background_color”: “#5490CC”,<br>  “theme_color”: “#F4981F”,<br>  “description”: “My First APP”,<br>  “icons”: […]<br>}</p>
<p>{% endcodeblock %}</p>
<p>重新建立捷徑後再啟動，可以看到<strong>啟動畫面</strong>的背景顏色與手機上方的狀態列顏色都改變了。<br><img src="/images/angular/training/pwa/pwa_20.png" alt="img"><br><img src="/images/angular/training/pwa/pwa_21.png" alt="img">  </p>
<p>{% img /images/download.png 36 %}<a href="/uploads/first-app_2017-09-25.zip"><strong>first-app_2017-09-25.zip</strong></a>  </p>
